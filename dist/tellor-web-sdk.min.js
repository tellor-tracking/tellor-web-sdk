this.window=this.window||{},this.window.Tellor=function(){"use strict";var t=function(t){return void 0!==t.name},n=function(t){return"events=["+JSON.stringify(t)+"]"},e=function(e){if(t(e)){var r=void 0;try{r=n(e)}catch(t){return}return r}},r={event:e},i=(function(){function t(t){this.value=t}function n(n){function e(t,n){return new Promise(function(e,i){var a={key:t,arg:n,resolve:e,reject:i,next:null};s?s=s.next=a:(o=s=a,r(t,n))})}function r(e,o){try{var s=n[e](o),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):i(s.done?"return":"normal",s.value)}catch(t){i("throw",t)}}function i(t,n){switch(t){case"return":o.resolve({value:n,done:!0});break;case"throw":o.reject(n);break;default:o.resolve({value:n,done:!1})}o=o.next,o?r(o.key,o.arg):s=null}var o,s;this._invoke=e,"function"!=typeof n.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(t){return this._invoke("next",t)},n.prototype.throw=function(t){return this._invoke("throw",t)},n.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new n(t.apply(this,arguments))}},await:function(n){return new t(n)}}}(),function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}),o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),s=function(){function t(n){i(this,t),this.tellor=n,this.runInterval=1e4,this.apiEndPoint="/track",this.standardParams=this._formatStandardParams(),setInterval(this.run.bind(this),this.runInterval)}return o(t,[{key:"run",value:function(){var t=this.tellor.store.get();t.forEach(this._XHRGet.bind(this))}},{key:"_XHRGet",value:function(t){var n=this.tellor.store;try{var e=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.open("GET",""+this.tellor.url+this.apiEndPoint+"?"+this.standardParams+"&"+t.params,!0),e.onreadystatechange=function(){4===this.readyState&&this.status>=200&&this.status<300?n.remove(t):4===this.readyState&&console.error("Failed to track",t)},e.send()}catch(e){n.remove(t)}}},{key:"_formatStandardParams",value:function(){var t=this.tellor,n="sdk="+t.sdk+"&app_key="+t.appKey+"&app_version="+t.appVersion;return t.user&&t.user.id&&(n+="userId="+t.user.id),t.user&&t.user.id&&t.user.name&&(n+="userId="+t.user.name),n}}]),t}(),a=function(){function t(n){i(this,t),this.transport=n,this.q=[]}return o(t,[{key:"submit",value:function(t){this.q.push({params:t}),this.transport.run()}},{key:"get",value:function(){return this.q}},{key:"remove",value:function(t){var n=this.q.indexOf(t);n&&this.q.splice(n,1)}}]),t}(),u=function(){function t(n,e,r,o){var s=o.appKey,a=o.appVersion,u=void 0===a?"1":a,c=o.url,h=o.user;i(this,t),this.sdk="web",this.appKey=s,this.appVersion=u,this.url=c,this.user=h,this.formatters=n,this.transport=new e(this),this.store=new r(this.transport),void 0!==window.__ttq&&window.__ttq.forEach(this.track)}return o(t,[{key:"track",value:function(t){var n=this.formatters.event(t);n&&this.store.submit(n)}}]),t}(),c={init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.appKey&&t.url?void(window.Tellor=new u(r,s,a,t)):console.warn("You must provide app_key and url")}};return c}();